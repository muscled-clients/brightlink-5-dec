<div class="container container--flush container--narrow">
  {% assign faq_title = faq_data.title | default: section.settings.title | default: 'Knowledge Center' %}
  {% assign faq_subtitle = faq_data.subtitle | default: section.settings.subtitle | default: 'Everything you need to know about Pro Spectrum' %}

  <div class="knowledge-center__header">
    <span class="knowledge-center__label" style="color: #FFD700;">{{ section.settings.label | default: 'KNOWLEDGE CENTER' }}</span>
    <h2 class="knowledge-center__title">{{ faq_title }}</h2>
    <p class="knowledge-center__subtitle">{{ faq_subtitle }}</p>
  </div>
  
  <div class="faq" itemscope itemtype="https://schema.org/FAQPage">
    <div class="faq__group-list">
      {%- for block in section.blocks -%}
        {%- if block.type == 'separator' -%}
  {%- unless forloop.first -%}
    </div> <!-- Close previous group -->
  {%- endunless -%}
  
  {%- assign group_id = 'group-' | append: block.id -%}
  <div class="faq__group" data-group-id="{{ group_id }}">
    <div class="faq__group-header" {{ block.shopify_attributes }}>
      <button class="faq__group-title-wrapper" data-action="toggle-group" aria-expanded="false" aria-controls="{{ group_id }}">
        <div class="faq__group-title heading h2" id="block-{{ block.id }}">
          {%- if block.settings.icon_image -%}
            <span class="faq__group-icon" style="
              {% if block.settings.icon_width %}width: {{ block.settings.icon_width }}px;{% endif %}
              {% if block.settings.icon_height %}height: {{ block.settings.icon_height }}px;{% endif %}
              {% if block.settings.icon_color %}color: {{ block.settings.icon_color }};{% endif %}
              {% if block.settings.icon_margin_top %}margin-top: {{ block.settings.icon_margin_top }}px;{% endif %}
              {% if block.settings.icon_margin_right %}margin-right: {{ block.settings.icon_margin_right }}px;{% endif %}
              {% if block.settings.icon_margin_bottom %}margin-bottom: {{ block.settings.icon_margin_bottom }}px;{% endif %}
              {% if block.settings.icon_margin_left %}margin-left: {{ block.settings.icon_margin_left }}px;{% endif %}
            ">
              <img src="{{ block.settings.icon_image | img_url: '200x' }}" 
                   alt="{{ block.settings.title | escape }}"
                   style="width: 100%; height: 100%; object-fit: contain;">
            </span>
          {%- endif -%}
          
          <span class="faq__group-title-text">
            {{- block.settings.title | escape -}}
          </span>
          
          <span class="faq__group-arrow-icon">
            <svg class="group-arrow-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
        </div>
      </button>
    </div>
    
    <div id="{{ group_id }}" class="faq__group-content" style="display: none;">
{%- endif -%}
        
        {%- if block.type == 'question' -%}
          <div class="faq__item " itemscope itemprop="mainEntity" itemtype="https://schema.org/Question" {{ block.shopify_attributes }}>
            <div class="faq__item-wrapper">
              <button class="faq__question heading h4" data-action="toggle-collapsible" aria-expanded="false" aria-controls="block-{{ block.id }}" itemprop="name">
                <span class="faq__question-text">{{ block.settings.title | escape }}</span>
                <span class="faq__arrow-icon">
                  <svg class="arrow-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
              </button>

              <div id="block-{{ block.id }}" class="faq__answer-wrapper" itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer" style="display: none;">
                <div class="faq__answer rte" itemprop="text">
                  {{ block.settings.answer }}
                </div>
              </div>
            </div>
          </div>
        {%- endif -%}
        
        {%- if forloop.last -%}
            </div> <!-- Close group-content -->
          </div> <!-- Close group -->
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
</div>

<style>
  /* Reset and base styles */
  .faq__group-title-wrapper {
    background: #0A0E18;
     width: 100% !important;
    background: none;
    border: none;
    padding: 0 !important;
    cursor: pointer;
    text-align: left;
    display: block !important; /* Changed from flex to block */
  }
  
  .faq__group-title-text {
    flex: 1 !important;
    text-align: left !important;
}

  .faq__group-title-content {
    display: flex !important;
    align-items: center !important;
    flex: 1 !important;
    text-align: left !important;
    min-width: 0 !important;
  }
  
  .faq__item {
    gap: 16px;
    background: transparent;
    display: flex;
    padding: 28px 12px;
    align-items: center;
    gap: 16px;
    align-self: stretch;
    border: none;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }
  
  .faq__group {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    margin-bottom: 16px;
    width: 100% !important;
  }
  
  .faq__group-content {
    width: 100%;
  }
  
  .faq__group-header {
    width: 100% !important;
    margin-bottom: 0;
  }
  
  button.faq__question.heading.h4 {
    flex: 1 0 0;
    color: rgb(255, 255, 255);
    font-size: 14px;
    font-style: normal;
    font-weight: 600;
    line-height: 20px;
    width: 100%;
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    text-align: left;
  }
  
  .faq__group-title {
     display: flex !important;
    align-items: center !important;
    padding: 29px 12px !important;
    align-self: stretch !important;
    border-radius: 16px !important;
    border: 1px solid rgba(255, 255, 255, 0.10) !important;
    background: rgba(255, 255, 255, 0.02) !important;
    box-shadow: 0 0 40px 0 rgba(10, 132, 255, 0.15) !important;
    color: #FFF !important;
    font-size: 16px !important;
    font-style: normal !important;
    font-weight: 700 !important;
    line-height: normal !important;
    margin: 0 !important;
    width: 100% !important;
    min-height: 60px !important;
    box-sizing: border-box !important;
    text-align: left !important;
    justify-content: flex-start !important;
    position: relative !important;
    padding-right: 40px !important; /* Space for the arrow */
  }
  
  /* Fix for the button wrapper issue - make it full width */
  .faq__group-title-wrapper {
    width: 100% !important;
    display: flex !important;
    align-items: stretch !important;
  }
  
  .faq__group-icon {
     display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    flex-shrink: 0 !important;
    margin-right: 12px !important;
  }
  
  .faq__group-icon img {
    display: block !important;
  }
  
  .container.container--flush.container--narrow {
    padding: 40px 0px !important;
  }
  
  
  
  /* Group arrow positioning */
  .faq__group-arrow-icon {
    position: absolute !important;
    right: 12px !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
    width: 24px !important;
    height: 24px !important;
  }
  
  /* Position relative for the button to position arrow */
  .faq__group-title-wrapper {
    position: relative !important;
  }
  
  .group-arrow-icon {
    width: 100% !important;
    height: 100% !important;
    color: #FFFFFF !important;
    transition: transform 0.3s ease !important;
  }
  
  /* Group arrow points DOWN when closed */
  .faq__group-title-wrapper[aria-expanded="false"] .group-arrow-icon {
    transform: translateY(-50%) rotate(0deg) !important;
  }
  
  /* Group arrow points UP when open */
  .faq__group-title-wrapper[aria-expanded="true"] .group-arrow-icon {
    transform: translateY(-50%) rotate(180deg) !important;
  }
  
  /* Ensure the title text aligns left and doesn't wrap under arrow */
  .faq__group-title {
    padding-right: 40px !important; /* Space for the arrow */
  }
  
  /* Question arrow positioning */
  .faq__question {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    width: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
  }
  
  .faq__question-text {
    flex: 1 !important;
    min-width: 0 !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: normal !important;
    padding-right: 20px !important;
    text-align: left !important;
  }
  
  .faq__arrow-icon {
    flex-shrink: 0 !important;
    width: 24px !important;
    height: 24px !important;
    min-width: 24px !important;
    margin-left: auto !important;
  }
  
  .arrow-icon {
    width: 100% !important;
    height: 100% !important;
    color: #FFFFFF !important;
    transition: transform 0.3s ease !important;
  }
  
  /* Question arrow points DOWN when closed */
  .faq__question[aria-expanded="false"] .arrow-icon {
    transform: rotate(0deg) !important;
  }
  
  /* Question arrow points UP when open */
  .faq__question[aria-expanded="true"] .arrow-icon {
    transform: rotate(180deg) !important;
  }
  
  .faq__item-wrapper {
    width: 100% !important;
  }
  
  /* Mobile responsive */
  @media (max-width: 749px) {
    .faq__group-title {
      padding: 20px 12px !important;
      padding-right: 40px !important;
      font-size: 14px !important;
    }
    
    .faq__group-arrow-icon,
    .faq__arrow-icon {
      width: 20px !important;
      height: 20px !important;
      min-width: 20px !important;
    }
    
    .faq__question-text {
      padding-right: 16px !important;
    }
    
    .faq__group-arrow-icon {
      right: 12px !important;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Toggle group (section separator) functionality
  document.querySelectorAll('[data-action="toggle-group"]').forEach(button => {
    button.addEventListener('click', function() {
      const expanded = this.getAttribute('aria-expanded') === 'true';
      const groupId = this.getAttribute('aria-controls');
      const groupContent = document.getElementById(groupId);
      
      // Toggle group content
      if (expanded) {
        this.setAttribute('aria-expanded', 'false');
        groupContent.style.display = 'none';
        
        // Also close all questions within this group
        groupContent.querySelectorAll('[data-action="toggle-collapsible"]').forEach(questionButton => {
          questionButton.setAttribute('aria-expanded', 'false');
          const answerId = questionButton.getAttribute('aria-controls');
          const answerWrapper = document.getElementById(answerId);
          if (answerWrapper) {
            answerWrapper.style.display = 'none';
          }
        });
      } else {
        this.setAttribute('aria-expanded', 'true');
        groupContent.style.display = 'block';
      }
    });
  });
  
  // Toggle question functionality
  document.querySelectorAll('[data-action="toggle-collapsible"]').forEach(button => {
    button.addEventListener('click', function() {
      const expanded = this.getAttribute('aria-expanded') === 'true';
      const answerId = this.getAttribute('aria-controls');
      const answerWrapper = document.getElementById(answerId);
      
      // Toggle answer
      if (expanded) {
        this.setAttribute('aria-expanded', 'false');
        if (answerWrapper) {
          answerWrapper.style.display = 'none';
        }
      } else {
        this.setAttribute('aria-expanded', 'true');
        if (answerWrapper) {
          answerWrapper.style.display = 'block';
        }
      }
    });
  });
});
</script>

{% schema %}
{
  "name": "FAQ",
  "settings": [
    {
      "type": "text",
      "id": "label",
      "label": "Section Label",
      "default": "KNOWLEDGE CENTER"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Knowledge Center"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Everything you need to know about Pro Spectrum"
    },
    {
      "type": "checkbox",
      "id": "show_contact_info",
      "label": "Show additional info",
      "info": "Additional info is displayed below all questions.",
      "default": true
    },
    {
      "type": "text",
      "id": "contact_info_heading",
      "label": "Heading",
      "default": "Any question?"
    },
    {
      "type": "richtext",
      "id": "contact_info_text",
      "label": "Text",
      "default": "<p>If we still haven't answered your question, you can contact us below and we will get back to you as soon as possible.</p>"
    },
    {
      "type": "header",
      "content": "Block 1"
    },
    {
      "type": "select",
      "id": "contact_1_icon",
      "label": "Icon",
      "options": [
        {
          "value": "bi-add-to-cart",
          "label": "Add to cart",
          "group": "Shop"
        },
        {
          "value": "bi-gift-wrap",
          "label": "Gift wrap",
          "group": "Shop"
        },
        {
          "value": "bi-gift-box",
          "label": "Gift box",
          "group": "Shop"
        },
        {
          "value": "bi-heart",
          "label": "Heart",
          "group": "Shop"
        },
        {
          "value": "bi-ecology",
          "label": "Ecology",
          "group": "Shop"
        },
        {
          "value": "bi-plant",
          "label": "Plant",
          "group": "Shop"
        },
        {
          "value": "bi-shop",
          "label": "Shop",
          "group": "Shop"
        },
        {
          "value": "bi-shop-pin",
          "label": "Shop with pin",
          "group": "Shop"
        },
        {
          "value": "bi-alert",
          "label": "Alert",
          "group": "Communication"
        },
        {
          "value": "bi-chat",
          "label": "Chat",
          "group": "Communication"
        },
        {
          "value": "bi-comment",
          "label": "Comment",
          "group": "Communication"
        },
        {
          "value": "bi-customer-support",
          "label": "Customer support",
          "group": "Communication"
        },
        {
          "value": "bi-email",
          "label": "Email",
          "group": "Communication"
        },
        {
          "value": "bi-network",
          "label": "Network",
          "group": "Communication"
        },
        {
          "value": "bi-newsletter",
          "label": "Newsletter",
          "group": "Communication"
        },
        {
          "value": "bi-love",
          "label": "Love",
          "group": "Communication"
        },
        {
          "value": "bi-phone",
          "label": "Phone",
          "group": "Communication"
        },
        {
          "value": "bi-share",
          "label": "Share",
          "group": "Communication"
        },
        {
          "value": "bi-delivery",
          "label": "Delivery",
          "group": "Delivery"
        },
        {
          "value": "bi-fast-delivery",
          "label": "Fast delivery",
          "group": "Delivery"
        },
        {
          "value": "bi-returns",
          "label": "Returns",
          "group": "Delivery"
        },
        {
          "value": "bi-time",
          "label": "Time",
          "group": "Delivery"
        },
        {
          "value": "bi-secure-payment",
          "label": "Secure payment",
          "group": "Security"
        },
        {
          "value": "bi-mobile-payment",
          "label": "Mobile payment",
          "group": "Security"
        },
        {
          "value": "bi-credit-card",
          "label": "Credit card",
          "group": "Security"
        },
        {
          "value": "bi-shield",
          "label": "Shield",
          "group": "Security"
        }
      ],
      "default": "bi-phone"
    },
    {
      "type": "text",
      "id": "contact_1_heading",
      "label": "Heading",
      "default": "Customer support"
    },
    {
      "type": "richtext",
      "id": "contact_1_text",
      "label": "Text",
      "default": "<p>Enter your text here</p>"
    },
    {
      "type": "header",
      "content": "Block 2"
    },
    {
      "type": "select",
      "id": "contact_2_icon",
      "label": "Icon",
      "options": [
        {
          "value": "bi-add-to-cart",
          "label": "Add to cart",
          "group": "Shop"
        },
        {
          "value": "bi-gift-wrap",
          "label": "Gift wrap",
          "group": "Shop"
        },
        {
          "value": "bi-gift-box",
          "label": "Gift box",
          "group": "Shop"
        },
        {
          "value": "bi-heart",
          "label": "Heart",
          "group": "Shop"
        },
        {
          "value": "bi-ecology",
          "label": "Ecology",
          "group": "Shop"
        },
        {
          "value": "bi-plant",
          "label": "Plant",
          "group": "Shop"
        },
        {
          "value": "bi-shop",
          "label": "Shop",
          "group": "Shop"
        },
        {
          "value": "bi-shop-pin",
          "label": "Shop with pin",
          "group": "Shop"
        },
        {
          "value": "bi-alert",
          "label": "Alert",
          "group": "Communication"
        },
        {
          "value": "bi-chat",
          "label": "Chat",
          "group": "Communication"
        },
        {
          "value": "bi-comment",
          "label": "Comment",
          "group": "Communication"
        },
        {
          "value": "bi-customer-support",
          "label": "Customer support",
          "group": "Communication"
        },
        {
          "value": "bi-email",
          "label": "Email",
          "group": "Communication"
        },
        {
          "value": "bi-network",
          "label": "Network",
          "group": "Communication"
        },
        {
          "value": "bi-newsletter",
          "label": "Newsletter",
          "group": "Communication"
        },
        {
          "value": "bi-love",
          "label": "Love",
          "group": "Communication"
        },
        {
          "value": "bi-phone",
          "label": "Phone",
          "group": "Communication"
        },
        {
          "value": "bi-share",
          "label": "Share",
          "group": "Communication"
        },
        {
          "value": "bi-delivery",
          "label": "Delivery",
          "group": "Delivery"
        },
        {
          "value": "bi-fast-delivery",
          "label": "Fast delivery",
          "group": "Delivery"
        },
        {
          "value": "bi-returns",
          "label": "Returns",
          "group": "Delivery"
        },
        {
          "value": "bi-time",
          "label": "Time",
          "group": "Delivery"
        },
        {
          "value": "bi-secure-payment",
          "label": "Secure payment",
          "group": "Security"
        },
        {
          "value": "bi-mobile-payment",
          "label": "Mobile payment",
          "group": "Security"
        },
        {
          "value": "bi-credit-card",
          "label": "Credit card",
          "group": "Security"
        },
        {
          "value": "bi-shield",
          "label": "Shield",
          "group": "Security"
        }
      ],
      "default": "bi-email"
    },
    {
      "type": "text",
      "id": "contact_2_heading",
      "label": "Heading",
      "default": "Send a message"
    },
    {
      "type": "richtext",
      "id": "contact_2_text",
      "label": "Text",
      "default": "<p>Enter your text here</p>"
    }
  ],
  "blocks": [
    {
      "type": "separator",
      "name": "Section separator",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Heading",
          "default": "Default"
        },
        {
          "type": "image_picker",
          "id": "icon_image",
          "label": "Icon image",
          "info": "Upload your custom icon"
        },
        {
          "type": "color",
          "id": "icon_color",
          "label": "Icon color",
          "default": "#FFD700"
        },
        {
          "type": "range",
          "id": "icon_width",
          "label": "Icon width",
          "min": 10,
          "max": 100,
          "step": 2,
          "unit": "px",
          "default": 24
        },
        {
          "type": "range",
          "id": "icon_height",
          "label": "Icon height",
          "min": 10,
          "max": 100,
          "step": 2,
          "unit": "px",
          "default": 24
        },
        {
          "type": "range",
          "id": "icon_margin_top",
          "label": "Icon top margin",
          "min": 0,
          "max": 50,
          "step": 1,
          "unit": "px",
          "default": 0
        },
        {
          "type": "range",
          "id": "icon_margin_right",
          "label": "Icon right margin",
          "min": 0,
          "max": 50,
          "step": 1,
          "unit": "px",
          "default": 10
        },
        {
          "type": "range",
          "id": "icon_margin_bottom",
          "label": "Icon bottom margin",
          "min": 0,
          "max": 50,
          "step": 1,
          "unit": "px",
          "default": 0
        },
        {
          "type": "range",
          "id": "icon_margin_left",
          "label": "Icon left margin",
          "min": 0,
          "max": 50,
          "step": 1,
          "unit": "px",
          "default": 0
        }
      ]
    },
    {
      "type": "question",
      "name": "Question",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Question"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Answer"
        }
      ]
    }
  ],
  "presets": [
    {
      "category": "Text",
      "name": "Frequently Asked Questions",
      "settings": {},
      "blocks": [
        {
          "type": "separator",
          "settings": {
            "title": "Shipping",
            "icon_width": 24,
            "icon_height": 24
          }
        },
        {
          "type": "question",
          "settings": {
            "title": "Do you ship overseas?",
            "answer": "<p>Yes, we ship all over the world. Shipping costs will apply, and will be added at checkout. We run discounts and promotions all year, so stay tuned for exclusive deals.</p>"
          }
        },
        {
          "type": "question",
          "settings": {
            "title": "How long does shipping take?",
            "answer": "<p>Shipping typically takes 5-7 business days domestically and 10-14 business days internationally.</p>"
          }
        },
        {
          "type": "separator",
          "settings": {
            "title": "Product"
          }
        },
        {
          "type": "question",
          "settings": {
            "title": "Can I return my product?",
            "answer": "<p>We always aim for make sure our customers love our products, but if you do need to return an order, we're happy to help. Just email us directly and we'll take you through the process.</p>"
          }
        },
        {
          "type": "question",
          "settings": {
            "title": "What is your warranty policy?",
            "answer": "<p>All products come with a 1-year manufacturer's warranty covering defects in materials and workmanship.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}