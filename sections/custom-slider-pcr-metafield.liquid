{% if template.name == 'product' %}
  {% if product.metafields.custom.section_custom_slider_pcr.value.first_slide_title.value == blank and product.metafields.custom.section_custom_slider_pcr.value.first_slide_description.value == blank %}
    <style>
      #shopify-section-{{ section.id }},
      .custom-slider-pcr-mobile-{{ section.id }} {
        display: none;
      }
    </style>
  {% endif %}
{% endif %}

{% style %}
  /* Reset styles scoped to this section */
  #shopify-section-{{ section.id }} .slider-metafield-wrapper * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  /* Main wrapper */
  #shopify-section-{{ section.id }} .slider-metafield-wrapper {
    width: {{ section.settings.wrapper-container-width }}%;
    max-width: 1400px;
    margin: 60px auto;
    padding: 0 20px;
  }

  /* Section Header */
  #shopify-section-{{ section.id }} .slider-metafield-header {
    text-align: center;
    margin-bottom: 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  #shopify-section-{{ section.id }} .slider-metafield-label {
    color: #D4AF37;
    text-align: center;
    font-family: Inter, sans-serif;
    font-size: 14px;
    font-style: normal;
    font-weight: 600;
    line-height: normal;
    letter-spacing: 2px;
    height: 20px;
    align-self: stretch;
    text-transform: uppercase;
    margin: 0;
  }

  #shopify-section-{{ section.id }} .slider-metafield-main-heading {
    color: #000;
    text-align: center;
    font-family: Inter, sans-serif;
    font-size: 48px;
    font-style: normal;
    font-weight: 700;
    line-height: normal;
    letter-spacing: -2px;
    align-self: stretch;
    margin: 0;
  }

  #shopify-section-{{ section.id }} .slider-metafield-subtitle {
    color: #A0AEC0;
    text-align: center;
    font-family: Inter, sans-serif;
    font-size: 20px;
    font-style: normal;
    font-weight: 400;
    line-height: 28px;
    margin: 0;
  }

  /* Slider container */
  #shopify-section-{{ section.id }} .slider-metafield-container {
    position: relative;
    width: 100%;
    height: 720px;
    border-radius: 16px;
    overflow: hidden;
    background-color: #1a1a1a;
  }

  /* Background/Slide images */
  #shopify-section-{{ section.id }} .slider-metafield-slides {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  #shopify-section-{{ section.id }} .slider-metafield-slide {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.6s ease;
  }

  #shopify-section-{{ section.id }} .slider-metafield-slide.active-slide {
    opacity: 1;
  }

  #shopify-section-{{ section.id }} .slider-metafield-slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Gradient overlay */
  #shopify-section-{{ section.id }} .slider-metafield-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 50%;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.85) 0%, rgba(0, 0, 0, 0.4) 50%, transparent 100%);
    pointer-events: none;
  }

  /* Text content - bottom left */
  #shopify-section-{{ section.id }} .slider-metafield-content {
    position: absolute;
    bottom: 60px;
    left: 40px;
    right: 40px;
    z-index: 10;
  }

  #shopify-section-{{ section.id }} .slider-metafield-text {
    max-width: 390px;
  }

  #shopify-section-{{ section.id }} .slider-metafield-text-item {
    display: none;
    width: 390px;
    max-width: 100%;
    height: auto;
    min-height: 98px;
    padding: 24px;
    flex-direction: column;
    justify-content: center;
    align-items: flex-start;
    gap: 8px;
    border-radius: 12px;
    border: 2px solid rgba(10, 132, 255, 0.30);
    background: rgba(0, 0, 0, 0.70);
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
  }

  #shopify-section-{{ section.id }} .slider-metafield-text-item.active-text {
    display: flex;
    animation: fadeInText 0.5s ease;
  }

  @keyframes fadeInText {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  #shopify-section-{{ section.id }} .slider-metafield-heading {
    color: #FFF;
    font-family: Inter, sans-serif;
    font-size: 20px;
    font-style: normal;
    font-weight: 700;
    line-height: normal;
    margin: 0;
  }

  #shopify-section-{{ section.id }} .slider-metafield-description {
    color: #A0AEC0;
    font-family: Inter, sans-serif;
    font-size: 12px;
    font-style: normal;
    font-weight: 400;
    line-height: normal;
  }

  #shopify-section-{{ section.id }} .slider-metafield-description p {
    margin: 0;
    font-size: inherit;
    color: inherit;
    line-height: inherit;
    font-family: inherit;
    font-weight: inherit;
  }

  /* Navigation dots - bottom center */
  #shopify-section-{{ section.id }} .slider-metafield-dots {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    width: 169px;
    padding: 14px 20px;
    justify-content: center;
    align-items: center;
    gap: 12px;
    border-radius: 15.862px;
    border: 0.991px solid rgba(10, 132, 255, 0.10);
    background: rgba(10, 14, 26, 0.70);
    z-index: 10;
  }

  #shopify-section-{{ section.id }} .slider-metafield-dot {
    width: 8px;
    height: 8px;
    flex-shrink: 0;
    border-radius: 100px;
    background: rgba(255, 255, 255, 0.30);
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
    padding: 0;
  }

  #shopify-section-{{ section.id }} .slider-metafield-dot:hover {
    background: rgba(255, 255, 255, 0.5);
  }

  #shopify-section-{{ section.id }} .slider-metafield-dot.active-dot {
    width: 10px;
    height: 10px;
    flex-shrink: 0;
    border-radius: 125px;
    background: #0A84FF;
  }

  /* Hide elements */
  #shopify-section-{{ section.id }} .slider-metafield-hide {
    display: none !important;
  }

  /* Responsive - Tablet */
  @media screen and (max-width: 1024px) {
    #shopify-section-{{ section.id }} .slider-metafield-main-heading {
      font-size: 36px;
      letter-spacing: -1px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-subtitle {
      font-size: 18px;
      line-height: 26px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-container {
      height: 600px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-content {
      bottom: 50px;
      left: 30px;
      right: 30px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-heading {
      font-size: 18px;
    }
  }

  /* Responsive - Mobile */
  @media screen and (max-width: 768px) {
    #shopify-section-{{ section.id }} .slider-metafield-wrapper {
      margin: 40px auto;
      padding: 0 15px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-header {
      margin-bottom: 30px;
      gap: 8px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-label {
      font-size: 12px;
      letter-spacing: 1.5px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-main-heading {
      font-size: 28px;
      letter-spacing: -1px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-subtitle {
      font-size: 16px;
      line-height: 24px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-container {
      height: 500px;
      border-radius: 12px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-content {
      bottom: 45px;
      left: 20px;
      right: 20px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-text {
      max-width: 100%;
    }

    #shopify-section-{{ section.id }} .slider-metafield-text-item {
      width: 100%;
      padding: 20px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-heading {
      font-size: 16px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-description {
      font-size: 11px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-dots {
      bottom: 15px;
      width: auto;
      padding: 12px 16px;
      gap: 10px;
    }
  }

  /* Responsive - Small Mobile */
  @media screen and (max-width: 480px) {
    #shopify-section-{{ section.id }} .slider-metafield-container {
      height: 400px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-content {
      bottom: 40px;
      left: 15px;
      right: 15px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-text-item {
      padding: 16px;
      min-height: auto;
    }

    #shopify-section-{{ section.id }} .slider-metafield-heading {
      font-size: 14px;
    }

    #shopify-section-{{ section.id }} .slider-metafield-description {
      font-size: 10px;
    }
  }
{% endstyle %}


<!-- New Slider Design -->
{% assign slider_metafield = product.metafields.custom.section_custom_slider_pcr.value %}

<div class="slider-metafield-wrapper" id="slider-metafield-{{ section.id }}">
  <!-- Section Header -->
  {% if section.settings.section_label != blank or section.settings.section_heading != blank or section.settings.section_subtitle != blank %}
    <div class="slider-metafield-header">
      {% if section.settings.section_label != blank %}
        <div class="slider-metafield-label">{{ section.settings.section_label }}</div>
      {% endif %}
      {% if section.settings.section_heading != blank %}
        <h2 class="slider-metafield-main-heading">{{ section.settings.section_heading }}</h2>
      {% endif %}
      {% if section.settings.section_subtitle != blank %}
        <p class="slider-metafield-subtitle">{{ section.settings.section_subtitle }}</p>
      {% endif %}
    </div>
  {% endif %}

  <div class="slider-metafield-container">
    <!-- Slide Images -->
    <div class="slider-metafield-slides">
      {% if slider_metafield.first_slide_image.value != blank %}
        <div class="slider-metafield-slide active-slide" data-slide="0">
          <img src="{{ slider_metafield.first_slide_image.value | img_url: '1400x' }}" alt="{{ slider_metafield.first_slide_title.value }}">
        </div>
      {% endif %}
      {% if slider_metafield.second_slide_image.value != blank %}
        <div class="slider-metafield-slide" data-slide="1">
          <img src="{{ slider_metafield.second_slide_image.value | img_url: '1400x' }}" alt="{{ slider_metafield.second_slide_title.value }}">
        </div>
      {% endif %}
      {% if slider_metafield.third_slide_image.value != blank %}
        <div class="slider-metafield-slide" data-slide="2">
          <img src="{{ slider_metafield.third_slide_image.value | img_url: '1400x' }}" alt="{{ slider_metafield.third_slide_title.value }}">
        </div>
      {% endif %}
      {% if slider_metafield.fourth_slide_image.value != blank %}
        <div class="slider-metafield-slide" data-slide="3">
          <img src="{{ slider_metafield.fourth_slide_image.value | img_url: '1400x' }}" alt="{{ slider_metafield.fourth_slide_title.value }}">
        </div>
      {% endif %}
    </div>

    <!-- Gradient Overlay -->
    <div class="slider-metafield-overlay"></div>

    <!-- Text Content - Bottom Left -->
    <div class="slider-metafield-content">
      <div class="slider-metafield-text">
        {% if slider_metafield.first_slide_title.value != blank %}
          <div class="slider-metafield-text-item active-text" data-text="0">
            <h3 class="slider-metafield-heading">{{ slider_metafield.first_slide_title.value }}</h3>
            <div class="slider-metafield-description">{{ slider_metafield.first_slide_description | metafield_tag }}</div>
          </div>
        {% endif %}
        {% if slider_metafield.second_slide_title.value != blank %}
          <div class="slider-metafield-text-item" data-text="1">
            <h3 class="slider-metafield-heading">{{ slider_metafield.second_slide_title.value }}</h3>
            <div class="slider-metafield-description">{{ slider_metafield.second_slide_description | metafield_tag }}</div>
          </div>
        {% endif %}
        {% if slider_metafield.third_slide_title.value != blank %}
          <div class="slider-metafield-text-item" data-text="2">
            <h3 class="slider-metafield-heading">{{ slider_metafield.third_slide_title.value }}</h3>
            <div class="slider-metafield-description">{{ slider_metafield.third_slide_description | metafield_tag }}</div>
          </div>
        {% endif %}
        {% if slider_metafield.fourth_slide_title.value != blank %}
          <div class="slider-metafield-text-item" data-text="3">
            <h3 class="slider-metafield-heading">{{ slider_metafield.fourth_slide_title.value }}</h3>
            <div class="slider-metafield-description">{{ slider_metafield.fourth_slide_description | metafield_tag }}</div>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Navigation Dots - Bottom Center -->
    <div class="slider-metafield-dots">
      {% if slider_metafield.first_slide_image.value != blank or slider_metafield.first_slide_title.value != blank %}
        <button class="slider-metafield-dot active-dot" data-dot="0" aria-label="Go to slide 1"></button>
      {% endif %}
      {% if slider_metafield.second_slide_image.value != blank or slider_metafield.second_slide_title.value != blank %}
        <button class="slider-metafield-dot" data-dot="1" aria-label="Go to slide 2"></button>
      {% endif %}
      {% if slider_metafield.third_slide_image.value != blank or slider_metafield.third_slide_title.value != blank %}
        <button class="slider-metafield-dot" data-dot="2" aria-label="Go to slide 3"></button>
      {% endif %}
      {% if slider_metafield.fourth_slide_image.value != blank or slider_metafield.fourth_slide_title.value != blank %}
        <button class="slider-metafield-dot" data-dot="3" aria-label="Go to slide 4"></button>
      {% endif %}
    </div>
  </div>
</div>

<script>
  (function() {
    const wrapper = document.getElementById('slider-metafield-{{ section.id }}');
    if (!wrapper) return;

    const container = wrapper.querySelector('.slider-metafield-container');
    const slides = wrapper.querySelectorAll('.slider-metafield-slide');
    const textItems = wrapper.querySelectorAll('.slider-metafield-text-item');
    const dots = wrapper.querySelectorAll('.slider-metafield-dot');

    let currentIndex = 0;
    const totalSlides = dots.length;

    // Drag/Swipe variables
    let isDragging = false;
    let startX = 0;
    let currentX = 0;
    const threshold = 50; // Minimum drag distance to trigger slide change

    function changeSlideMetafield(index) {
      if (index < 0) index = totalSlides - 1;
      if (index >= totalSlides) index = 0;

      currentIndex = index;

      // Update slides
      slides.forEach((slide, i) => {
        slide.classList.toggle('active-slide', i === index);
      });

      // Update text
      textItems.forEach((text, i) => {
        text.classList.toggle('active-text', i === index);
      });

      // Update dots
      dots.forEach((dot, i) => {
        dot.classList.toggle('active-dot', i === index);
      });
    }

    // Add click listeners to dots
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => changeSlideMetafield(index));
    });

    // Mouse drag events
    container.addEventListener('mousedown', (e) => {
      isDragging = true;
      startX = e.clientX;
      container.style.cursor = 'grabbing';
    });

    container.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      currentX = e.clientX;
    });

    container.addEventListener('mouseup', () => {
      if (!isDragging) return;
      handleDragEnd();
    });

    container.addEventListener('mouseleave', () => {
      if (!isDragging) return;
      handleDragEnd();
    });

    // Touch events for mobile
    container.addEventListener('touchstart', (e) => {
      isDragging = true;
      startX = e.touches[0].clientX;
    });

    container.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      currentX = e.touches[0].clientX;
    });

    container.addEventListener('touchend', () => {
      if (!isDragging) return;
      handleDragEnd();
    });

    function handleDragEnd() {
      isDragging = false;
      container.style.cursor = 'grab';

      const diff = startX - currentX;

      if (Math.abs(diff) > threshold) {
        if (diff > 0) {
          // Swiped left - go to next slide
          changeSlideMetafield(currentIndex + 1);
        } else {
          // Swiped right - go to previous slide
          changeSlideMetafield(currentIndex - 1);
        }
      }

      startX = 0;
      currentX = 0;
    }

    // Set initial cursor style
    container.style.cursor = 'grab';
  })();
</script>

{% schema %}
{
  "name": "Custom Slider Metafield",
  "settings": [
    {
      "type": "header",
      "content": "Section Header"
    },
    {
      "type": "text",
      "id": "section_label",
      "label": "Section Label",
      "default": "PRODUCT SHOWCASE"
    },
    {
      "type": "text",
      "id": "section_heading",
      "label": "Section Heading",
      "default": "Experience Premium Engineering"
    },
    {
      "type": "text",
      "id": "section_subtitle",
      "label": "Section Subtitle",
      "default": "Every detail crafted for visual excellence"
    },
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "range",
      "id": "wrapper-container-width",
      "min": 70,
      "max": 100,
      "step": 1,
      "label": "Container Width",
      "default": 100
    },
    {
      "type": "paragraph",
      "content": "Slide data is pulled from product metafield: custom.section_custom_slider_pcr"
    }
  ],
  "presets": [
    {
      "name": "Custom Slider Metafield"
    }
  ]
}
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}
