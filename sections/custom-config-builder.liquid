{{ 'custom-config-builder.css' | asset_url | stylesheet_tag }}

{% comment %} Get LED template data from product metafield {% endcomment %}
{% assign led_data = product.metafields.custom.led_template_data.value %}
{% assign config_builder_data = led_data.config_builder %}

<section class="custom-config" id="custom-config">
  <div class="custom-config__container">
    <!-- Header - Use metafield data if available, otherwise use section settings -->
    {% assign builder_title = config_builder_data.title | default: section.settings.title | default: 'Custom Configuration Builder' %}
    {% assign builder_description = config_builder_data.description | default: section.settings.subtitle | default: 'Need a different size? Configure a custom array' %}

    <div class="custom-config__content">
      <div class="custom-config__header">
        <div class="custom-config__header-text">
          <h2 class="custom-config__title">{{ builder_title }}</h2>
          <p class="custom-config__subtitle">{{ builder_description }}</p>
        </div>
      </div>

      <div class="custom-config__main">
        <!-- Left Side - Input Fields -->
        <div class="custom-config__inputs">
          <div class="custom-config__input-group">
            <label class="custom-config__input-label">CABINETS WIDE</label>
            <input type="number" class="custom-config__input" id="cabinets-wide" value="8" min="1" max="100">
          </div>
          <div class="custom-config__input-group">
            <label class="custom-config__input-label">CABINETS HIGH</label>
            <input type="number" class="custom-config__input" id="cabinets-high" value="8" min="1" max="100">
          </div>
        </div>

        <!-- Right Side - Results -->
        <div class="custom-config__results">
          <div class="custom-config__result-row">
            <span class="custom-config__result-label">Total Resolution:</span>
            <span class="custom-config__result-value" id="result-resolution">8,294,400 pixels</span>
          </div>
          <div class="custom-config__result-row">
            <span class="custom-config__result-label">Physical Size:</span>
            <span class="custom-config__result-value" id="result-size">15.75 × 8.86</span>
          </div>
          <div class="custom-config__result-row">
            <span class="custom-config__result-label">Diagonal:</span>
            <span class="custom-config__result-value" id="result-diagonal">257"</span>
          </div>
          <div class="custom-config__result-row">
            <span class="custom-config__result-label">Total Cabinets:</span>
            <span class="custom-config__result-value" id="result-cabinets">64 units</span>
          </div>
          <div class="custom-config__result-row">
            <span class="custom-config__result-label">Estimated Price:</span>
            <span class="custom-config__result-value custom-config__result-value--highlight" id="result-price">$149,000</span>
          </div>
        </div>
      </div>

      <div class="custom-config__buttons">
        <a href="{{ section.settings.quote_button_link | default: '#' }}" class="custom-config__btn custom-config__btn--primary">
          {{ section.settings.quote_button_text | default: 'GET CUSTOM QUOTE' }}
        </a>
        <a href="{{ section.settings.specs_button_link | default: '#' }}" class="custom-config__btn custom-config__btn--secondary">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          {{ section.settings.specs_button_text | default: 'GET LED SPECIFICATIONS' }}
        </a>
      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Cabinet specifications (can be customized per product via metafields)
  const CABINET_SPECS = {
    width: 500,        // Cabinet width in mm
    height: 500,       // Cabinet height in mm
    pixelsWide: 360,   // Pixels per cabinet width
    pixelsHigh: 360,   // Pixels per cabinet height
    pricePerCabinet: 2328  // Price per cabinet in USD
  };

  // DOM Elements
  const cabinetsWideInput = document.getElementById('cabinets-wide');
  const cabinetsHighInput = document.getElementById('cabinets-high');

  const resultResolution = document.getElementById('result-resolution');
  const resultSize = document.getElementById('result-size');
  const resultDiagonal = document.getElementById('result-diagonal');
  const resultCabinets = document.getElementById('result-cabinets');
  const resultPrice = document.getElementById('result-price');

  // Calculate and update all results
  function calculateResults() {
    const cabinetsWide = parseInt(cabinetsWideInput.value) || 1;
    const cabinetsHigh = parseInt(cabinetsHighInput.value) || 1;

    // Total cabinets
    const totalCabinets = cabinetsWide * cabinetsHigh;

    // Total resolution (pixels)
    const totalPixelsWide = cabinetsWide * CABINET_SPECS.pixelsWide;
    const totalPixelsHigh = cabinetsHigh * CABINET_SPECS.pixelsHigh;
    const totalResolution = totalPixelsWide * totalPixelsHigh;

    // Physical size in feet (convert from mm)
    const widthMm = cabinetsWide * CABINET_SPECS.width;
    const heightMm = cabinetsHigh * CABINET_SPECS.height;
    const widthFeet = (widthMm / 304.8).toFixed(2);
    const heightFeet = (heightMm / 304.8).toFixed(2);

    // Diagonal in inches
    const widthInches = widthMm / 25.4;
    const heightInches = heightMm / 25.4;
    const diagonalInches = Math.sqrt(widthInches * widthInches + heightInches * heightInches);

    // Estimated price
    const estimatedPrice = totalCabinets * CABINET_SPECS.pricePerCabinet;

    // Update display
    resultResolution.textContent = totalResolution.toLocaleString() + ' pixels';
    resultSize.textContent = widthFeet + ' × ' + heightFeet;
    resultDiagonal.textContent = Math.round(diagonalInches) + '"';
    resultCabinets.textContent = totalCabinets + ' units';
    resultPrice.textContent = '$' + estimatedPrice.toLocaleString();
  }

  // Event listeners
  if (cabinetsWideInput && cabinetsHighInput) {
    cabinetsWideInput.addEventListener('input', calculateResults);
    cabinetsHighInput.addEventListener('input', calculateResults);
  }

  // Initial calculation
  calculateResults();
});
</script>

{% schema %}
{
  "name": "Custom Config Builder",
  "tag": "section",
  "class": "custom-config-section",
  "settings": [
    {
      "type": "header",
      "content": "Header Section"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Custom Configuration Builder"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Need a different size? Configure a custom array"
    },
    {
      "type": "header",
      "content": "Buttons"
    },
    {
      "type": "text",
      "id": "quote_button_text",
      "label": "Quote Button Text",
      "default": "GET CUSTOM QUOTE"
    },
    {
      "type": "url",
      "id": "quote_button_link",
      "label": "Quote Button Link"
    },
    {
      "type": "text",
      "id": "specs_button_text",
      "label": "Specs Button Text",
      "default": "GET LED SPECIFICATIONS"
    },
    {
      "type": "url",
      "id": "specs_button_link",
      "label": "Specs Button Link"
    }
  ],
  "presets": [
    {
      "name": "Custom Config Builder"
    }
  ]
}
{% endschema %}
