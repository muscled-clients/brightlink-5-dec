{{ 'product-showcase.css' | asset_url | stylesheet_tag }}

<section class="product-showcase {{ section.settings.custom_class }}" id="product-showcase-{{ section.id }}">
  <div class="product-showcase__container">
    <!-- Section Label -->
    {% if section.settings.section_label != blank %}
      <span class="product-showcase__label">{{ section.settings.section_label }}</span>
    {% endif %}

    <!-- Main Heading -->
    {% if section.settings.heading != blank %}
      <h2 class="product-showcase__heading">{{ section.settings.heading }}</h2>
    {% endif %}

    <!-- Subheading -->
    {% if section.settings.subheading != blank %}
      <p class="product-showcase__subheading">{{ section.settings.subheading }}</p>
    {% endif %}

    <!-- Image Carousel -->
    <div class="product-showcase__carousel">
      <!-- Slides Container -->
      <div class="product-showcase__slides">
        {% for block in section.blocks %}
          {% if block.type == 'slide' %}
            <div class="product-showcase__slide {% if forloop.first %}product-showcase__slide--active{% endif %}" data-slide-index="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
              {% if block.settings.slide_image != blank %}
                <img
                  src="{{ block.settings.slide_image | image_url: width: 1200 }}"
                  alt="{{ block.settings.slide_title | default: 'Product image' }}"
                  class="product-showcase__image"
                  loading="lazy"
                >
              {% else %}
                <div class="product-showcase__placeholder">
                  <span>Add Image</span>
                </div>
              {% endif %}

              <!-- Slide Caption -->
              {% if block.settings.slide_title != blank or block.settings.slide_description != blank %}
                <div class="product-showcase__caption">
                  {% if block.settings.slide_title != blank %}
                    <h3 class="product-showcase__slide-title">{{ block.settings.slide_title }}</h3>
                  {% endif %}
                  {% if block.settings.slide_description != blank %}
                    <p class="product-showcase__slide-desc">{{ block.settings.slide_description }}</p>
                  {% endif %}
                </div>
              {% endif %}
            </div>
          {% endif %}
        {% endfor %}

        <!-- Navigation Dots - Inside Slides -->
        <div class="product-showcase__dots">
          {% for block in section.blocks %}
            {% if block.type == 'slide' %}
              <button class="product-showcase__dot {% if forloop.first %}product-showcase__dot--active{% endif %}" data-dot-index="{{ forloop.index0 }}" aria-label="Go to slide {{ forloop.index }}"></button>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const section = document.getElementById('product-showcase-{{ section.id }}');
    if (!section) return;

    const slides = section.querySelectorAll('.product-showcase__slide');
    const dots = section.querySelectorAll('.product-showcase__dot');

    if (slides.length === 0) return;

    let currentIndex = 0;
    let autoSlideInterval;
    const autoSlideDelay = {{ section.settings.autoplay_speed }}000;

    function showSlide(index) {
      if (index >= slides.length) index = 0;
      if (index < 0) index = slides.length - 1;

      slides.forEach((slide, i) => {
        slide.classList.remove('product-showcase__slide--active');
        if (i === index) {
          slide.classList.add('product-showcase__slide--active');
        }
      });

      dots.forEach((dot, i) => {
        dot.classList.remove('product-showcase__dot--active');
        if (i === index) {
          dot.classList.add('product-showcase__dot--active');
        }
      });

      currentIndex = index;
    }

    function nextSlide() {
      showSlide(currentIndex + 1);
    }

    function startAutoSlide() {
      if ({{ section.settings.autoplay | json }}) {
        autoSlideInterval = setInterval(nextSlide, autoSlideDelay);
      }
    }

    function stopAutoSlide() {
      clearInterval(autoSlideInterval);
    }

    // Dot click events
    dots.forEach((dot, index) => {
      dot.addEventListener('click', function() {
        stopAutoSlide();
        showSlide(index);
        startAutoSlide();
      });
    });

    // Start autoplay
    startAutoSlide();

    // Pause on hover
    section.addEventListener('mouseenter', stopAutoSlide);
    section.addEventListener('mouseleave', startAutoSlide);
  });
</script>

{% schema %}
{
  "name": "Product Showcase",
  "tag": "section",
  "class": "product-showcase-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "section_label",
      "label": "Section Label",
      "default": "PRODUCT SHOWCASE"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Experience Premium Engineering"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Every detail crafted for visual excellence"
    },
    {
      "type": "header",
      "content": "Slideshow Settings"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3,
      "max": 15,
      "step": 1,
      "default": 10,
      "unit": "sec",
      "label": "Autoplay Speed"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "label_font_size",
      "min": 10,
      "max": 20,
      "step": 1,
      "default": 12,
      "unit": "px",
      "label": "Label Font Size"
    },
    {
      "type": "range",
      "id": "heading_font_size",
      "min": 24,
      "max": 60,
      "step": 2,
      "default": 40,
      "unit": "px",
      "label": "Heading Font Size"
    },
    {
      "type": "range",
      "id": "subheading_font_size",
      "min": 14,
      "max": 24,
      "step": 1,
      "default": 16,
      "unit": "px",
      "label": "Subheading Font Size"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#0a0f14"
    },
    {
      "type": "color",
      "id": "label_color",
      "label": "Label Color",
      "default": "#FFD700"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "subheading_color",
      "label": "Subheading Color",
      "default": "#a0a0a0"
    },
    {
      "type": "color",
      "id": "dot_color",
      "label": "Dot Color",
      "default": "#4a5d75"
    },
    {
      "type": "color",
      "id": "dot_active_color",
      "label": "Active Dot Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Advanced"
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom CSS Class"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "slide_image",
          "label": "Slide Image"
        },
        {
          "type": "text",
          "id": "slide_title",
          "label": "Slide Title",
          "default": "Real-Time Financial Data at Scale"
        },
        {
          "type": "textarea",
          "id": "slide_description",
          "label": "Slide Description",
          "default": "Mission-critical market visualization with zero latency"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Showcase",
      "blocks": [
        {
          "type": "slide",
          "settings": {
            "slide_title": "Real-Time Financial Data at Scale",
            "slide_description": "Mission-critical market visualization with zero latency"
          }
        },
        {
          "type": "slide",
          "settings": {
            "slide_title": "Immersive Entertainment",
            "slide_description": "Crystal clear visuals for the ultimate viewing experience"
          }
        },
        {
          "type": "slide",
          "settings": {
            "slide_title": "Corporate Communications",
            "slide_description": "Professional displays for boardrooms and lobbies"
          }
        }
      ]
    }
  ]
}
{% endschema %}

<style>
  #product-showcase-{{ section.id }} {
    --ps-bg-color: {{ section.settings.bg_color }};
    --ps-label-color: {{ section.settings.label_color }};
    --ps-heading-color: {{ section.settings.heading_color }};
    --ps-subheading-color: {{ section.settings.subheading_color }};
    --ps-dot-color: {{ section.settings.dot_color }};
    --ps-dot-active-color: {{ section.settings.dot_active_color }};
    --ps-label-size: {{ section.settings.label_font_size }}px;
    --ps-heading-size: {{ section.settings.heading_font_size }}px;
    --ps-subheading-size: {{ section.settings.subheading_font_size }}px;
  }

  .product-showcase {
    margin-bottom: 120px;
  }

  @media screen and (max-width: 768px) {
    .product-showcase {
      margin-bottom: 50px;
    }
  }
</style>
