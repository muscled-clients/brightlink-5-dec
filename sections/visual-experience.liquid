{{ 'visual-experience.css' | asset_url | stylesheet_tag }}

<section class="visual-experience" id="visual-experience-{{ section.id }}">
  <div class="visual-experience__container">
    <div class="visual-experience__content">
      <!-- Left Side - Slider -->
      <div class="visual-experience__slider">
        <div class="visual-experience__slides">
          {% for block in section.blocks %}
            {% if block.type == 'slide' %}
              <div
                class="visual-experience__slide {% if forloop.first %}visual-experience__slide--active{% endif %}"
                data-slide-index="{{ forloop.index0 }}"
                {{ block.shopify_attributes }}
              >
                {% if block.settings.image != blank %}
                  <img
                    src="{{ block.settings.image | image_url: width: 800 }}"
                    alt="{{ block.settings.image_alt | default: section.settings.heading }}"
                    loading="lazy"
                    width="800"
                    height="500"
                  >
                {% else %}
                  <div class="visual-experience__slide-placeholder">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zM5 15h14v3H5z"/>
                    </svg>
                  </div>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}

          {% if section.blocks.size == 0 %}
            <div class="visual-experience__slide visual-experience__slide--active">
              <div class="visual-experience__slide-placeholder">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zM5 15h14v3H5z"/>
                </svg>
              </div>
            </div>
          {% endif %}
        </div>

        <!-- Dots Navigation -->
        {% if section.blocks.size > 1 %}
          <div class="visual-experience__dots">
            {% for block in section.blocks %}
              {% if block.type == 'slide' %}
                <button
                  class="visual-experience__dot {% if forloop.first %}visual-experience__dot--active{% endif %}"
                  data-dot-index="{{ forloop.index0 }}"
                  aria-label="Go to slide {{ forloop.index }}"
                ></button>
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Right Side - Text Content -->
      <div class="visual-experience__text">
        {% if section.settings.heading != blank %}
          <h2 class="visual-experience__heading">{{ section.settings.heading }}</h2>
        {% endif %}

        {% if section.settings.description != blank %}
          <p class="visual-experience__description">{{ section.settings.description }}</p>
        {% endif %}

        <!-- CTA Box -->
        <div class="visual-experience__cta">
          <a href="{{ section.settings.primary_btn_link | default: '#order' }}" class="visual-experience__btn">
            {{ section.settings.primary_btn_text | default: 'ORDER NOW' }}
          </a>

          <div class="visual-experience__cta-footer">
            <a href="{{ section.settings.secondary_btn_link | default: '#book-call' }}" class="visual-experience__btn--secondary">
              {{ section.settings.secondary_btn_text | default: 'BOOK A CALL' }}
            </a>
            {% if section.settings.price_text != blank %}
              <span class="visual-experience__divider"></span>
              <span class="visual-experience__price">{{ section.settings.price_text }}</span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const section = document.querySelector('#visual-experience-{{ section.id }}');
  if (!section) return;

  const slides = section.querySelectorAll('.visual-experience__slide');
  const dots = section.querySelectorAll('.visual-experience__dot');

  if (slides.length <= 1) return;

  let currentIndex = 0;
  let autoSlideInterval;

  function goToSlide(index) {
    slides.forEach(slide => slide.classList.remove('visual-experience__slide--active'));
    dots.forEach(dot => dot.classList.remove('visual-experience__dot--active'));

    slides[index].classList.add('visual-experience__slide--active');
    dots[index].classList.add('visual-experience__dot--active');

    currentIndex = index;
  }

  function nextSlide() {
    const next = (currentIndex + 1) % slides.length;
    goToSlide(next);
  }

  // Dot click handlers
  dots.forEach((dot, index) => {
    dot.addEventListener('click', function() {
      goToSlide(index);
      resetAutoSlide();
    });
  });

  // Auto-slide functionality
  function startAutoSlide() {
    autoSlideInterval = setInterval(nextSlide, 5000);
  }

  function resetAutoSlide() {
    clearInterval(autoSlideInterval);
    startAutoSlide();
  }

  // Start auto-slide
  startAutoSlide();

  // Pause on hover
  section.addEventListener('mouseenter', () => clearInterval(autoSlideInterval));
  section.addEventListener('mouseleave', startAutoSlide);
});
</script>

{% schema %}
{
  "name": "Visual Experience",
  "tag": "section",
  "class": "visual-experience-section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Elevate Your Visual Experience Today"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Transform your space with Pro Spectrum's 4K LED Video Wall. Designed for high-traffic environments, it delivers unmatched clarity and reliability. Contact us today to bring stunning visuals to your business!"
    },
    {
      "type": "header",
      "content": "CTA Buttons"
    },
    {
      "type": "text",
      "id": "primary_btn_text",
      "label": "Primary Button Text",
      "default": "ORDER NOW"
    },
    {
      "type": "url",
      "id": "primary_btn_link",
      "label": "Primary Button Link"
    },
    {
      "type": "text",
      "id": "secondary_btn_text",
      "label": "Secondary Button Text",
      "default": "BOOK A CALL"
    },
    {
      "type": "url",
      "id": "secondary_btn_link",
      "label": "Secondary Button Link"
    },
    {
      "type": "text",
      "id": "price_text",
      "label": "Price Text",
      "default": "$19,250.00 (30% DEPOSIT)"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Slide Image"
        },
        {
          "type": "text",
          "id": "image_alt",
          "label": "Image Alt Text"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Visual Experience",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}
